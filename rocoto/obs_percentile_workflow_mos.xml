<?xml version="1.0"?>
<!DOCTYPE workflow
[
  <!ENTITY VER "MOS">
  <!ENTITY PTMPROOT "/lfs/h1/mdl/ptmp/steven.levine">
  <!ENTITY STMPROOT "/lfs/h1/mdl/stmp/steven.levine">
  <!ENTITY ACT "NBM-DEV">
  <!ENTITY NODESIZE "128">
  <!ENTITY RUNDAY "20221102">
  <!ENTITY VAR "mint">
  <!ENTITY HOMEDIR "/lfs/h1/mdl/nbm/save/steven.levine/plotters/percentile_obs_event">
  <!ENTITY REGION "MTR">
  <!ENTITY NETWORK "ALL">
]>
<workflow realtime="F" scheduler="pbspro" cyclethrottle="1" taskthrottle="3">
  <log>
    <cyclestr>/lfs/h1/mdl/ptmp/steven.levine/rocotolog/percplot.@Y@m@d@H</cyclestr>
  </log>
  <cycledef group="daily">202211031200 202211031200 24:00:00</cycledef>
  <!--<task name="get_blend_core" cycledefs="daily" maxtries="2">
    <jobname>
      <cyclestr>core_@Y@m@d</cyclestr>
    </jobname>
    <command>
      <cyclestr>&HOMEDIR;/jobs/get_nbm_core.sh</cyclestr>
    </command>
    <join>
      <cyclestr>&PTMPROOT;/logs/get_nbmcore_&VER;_&VAR;_@Y@m@d.log</cyclestr>
    </join>
    <queue>dev_transfer</queue>
    <account>&ACT;</account>
    <nodes>1:ppn=1</nodes>
    <nodesize>&NODESIZE;</nodesize>
    <memory>5G</memory>
    <walltime>0:15:00</walltime>
    <envar>
      <name>PDY</name>
      <value>&RUNDAY;</value>
    </envar>
    <envar>
      <name>VAR</name>
      <value>&VAR;</value>
    </envar>
    <envar>
      <name>VER</name>
      <value>&VER;</value>
    </envar>
    <envar>
      <name>PTMP</name>
      <value>&PTMPROOT;</value>
    </envar>
    <envar>
      <name>STMP</name>
      <value>&STMPROOT;</value>
    </envar>
    <envar>
      <name>HOME</name>
      <value>&HOMEDIR;</value>
    </envar>
  </task>
  <task name="core_to_ra" cycledefs="daily" maxtries="2">
    <jobname>
      <cyclestr>corera_@Y@m@d</cyclestr>
    </jobname>
    <command>&HOMEDIR;/jobs/core_to_ra.sh</command>
    <join>
      <cyclestr>&PTMPROOT;/logs/core2ra_&VER;_&VAR;_@Y@m@d.log</cyclestr>
    </join>
    <dependency>
      <taskdep task="get_blend_core" state="succeeded"/>
    </dependency>
    <queue>dev</queue>
    <account>&ACT;</account>
    <nodes>1:ppn=1</nodes>
    <nodesize>&NODESIZE;</nodesize>
    <memory>15G</memory>
    <walltime>0:10:00</walltime>
    <envar>
      <name>PDY</name>
      <value>&RUNDAY;</value>
    </envar>
    <envar>
      <name>VAR</name>
      <value>&VAR;</value>
    </envar>
    <envar>
      <name>VER</name>
      <value>&VER;</value>
    </envar>
    <envar>
      <name>PTMP</name>
      <value>&PTMPROOT;</value>
    </envar>
    <envar>
      <name>STMP</name>
      <value>&STMPROOT;</value>
    </envar>
    <envar>
      <name>HOME</name>
      <value>&HOMEDIR;</value>
    </envar>
  </task>-->
  <task name="get_blend_qmd" cycledefs="daily" maxtries="2">
    <jobname>
      <cyclestr>qmd_&RUNDAY;</cyclestr>
    </jobname>
    <command>
      <cyclestr>&HOMEDIR;/jobs/get_nbm_qmd.sh</cyclestr>
    </command>
    <join>
      <cyclestr>&PTMPROOT;/logs/get_nbmqmd_&VER;_&VAR;_@Y@m@d.log</cyclestr>
    </join>
    <queue>dev_transfer</queue>
    <account>&ACT;</account>
    <nodes>1:ppn=1</nodes>
    <nodesize>&NODESIZE;</nodesize>
    <memory>15G</memory>
    <walltime>0:30:00</walltime>
    <envar>
      <name>PDY</name>
      <value>&RUNDAY;</value>
    </envar>
    <envar>
      <name>VAR</name>
      <value>&VAR;</value>
    </envar>
    <envar>
      <name>VER</name>
      <value>&VER;</value>
    </envar>
    <envar>
      <name>PTMP</name>
      <value>&PTMPROOT;</value>
    </envar>
    <envar>
      <name>STMP</name>
      <value>&STMPROOT;</value>
    </envar>
    <envar>
      <name>HOME</name>
      <value>&HOMEDIR;</value>
    </envar>
  </task>
  <task name="mos_to_ra" cycledefs="daily" maxtries="2">
    <jobname>
      <cyclestr>mosra_&RUNDAY;</cyclestr>
    </jobname>
    <command>&HOMEDIR;/jobs/qmd_to_ra_mos.sh</command>
    <join>
      <cyclestr>&PTMPROOT;/logs/mos2ra_&VER;_&VAR;_@Y@m@d.log</cyclestr>
    </join>
    <queue>dev</queue>
    <account>&ACT;</account>
    <nodes>1:ppn=1</nodes>
    <nodesize>&NODESIZE;</nodesize>
    <memory>30G</memory>
    <walltime>0:30:00</walltime>
    <envar>
      <name>PDY</name>
      <value>&RUNDAY;</value>
    </envar>
    <envar>
      <name>VAR</name>
      <value>&VAR;</value>
    </envar>
    <envar>
      <name>VER</name>
      <value>&VER;</value>
    </envar>
    <envar>
      <name>PTMP</name>
      <value>&PTMPROOT;</value>
    </envar>
    <envar>
      <name>STMP</name>
      <value>&STMPROOT;</value>
    </envar>
    <envar>
      <name>HOME</name>
      <value>&HOMEDIR;</value>
    </envar>
  </task>
  <task name="qmd_to_ra" cycledefs="daily" maxtries="2">
    <jobname>
      <cyclestr>qmdra_&RUNDAY;</cyclestr>
    </jobname>
    <dependency>
      <taskdep task="get_blend_qmd" state="succeeded"/>  
    </dependency>
    <command>&HOMEDIR;/jobs/qmd_to_ra.sh</command>
    <join>
      <cyclestr>&PTMPROOT;/logs/qmd2ra_&VER;_&VAR;_@Y@m@d.log</cyclestr>
    </join>
    <queue>dev</queue>
    <account>&ACT;</account>
    <nodes>1:ppn=1</nodes>
    <nodesize>&NODESIZE;</nodesize>
    <memory>30G</memory>
    <walltime>0:30:00</walltime>
    <envar>
      <name>PDY</name>
      <value>&RUNDAY;</value>
    </envar>
    <envar>
      <name>VAR</name>
      <value>&VAR;</value>
    </envar>
    <envar>
      <name>VER</name>
      <value>4.1</value>
    </envar>
    <envar>
      <name>PTMP</name>
      <value>&PTMPROOT;</value>
    </envar>
    <envar>
      <name>STMP</name>
      <value>&STMPROOT;</value>
    </envar>
    <envar>
      <name>HOME</name>
      <value>&HOMEDIR;</value>
    </envar>
  </task>
  <task name="get_synobs" cycledefs="daily" maxtries="2">
    <jobname>
      <cyclestr>synobs_@Y@m@d</cyclestr>
    </jobname>
    <command>
      <cyclestr>&HOMEDIR;/jobs/get_synobs.sh</cyclestr>
    </command>
    <join>
      <cyclestr>&PTMPROOT;/logs/get_synobs_&VER;_&VAR;_@Y@m@d.log</cyclestr>
    </join>
    <queue>dev_transfer</queue>
    <account>&ACT;</account>
    <nodes>1:ppn=1</nodes>
    <nodesize>&NODESIZE;</nodesize>
    <memory>1G</memory>
    <walltime>0:15:00</walltime>
    <envar>
      <name>PDY</name>
      <value>
        <cyclestr>@Y@m@d</cyclestr>
      </value>
    </envar>
    <envar>
      <name>VAR</name>
      <value>&VAR;</value>
    </envar>
    <envar>
      <name>PTMP</name>
      <value>&PTMPROOT;</value>
    </envar>
    <envar>
      <name>STMP</name>
      <value>&STMPROOT;</value>
    </envar>
    <envar>
      <name>HOME</name>
      <value>&HOMEDIR;</value>
    </envar>
    <envar>
      <name>REGION</name>
      <value>&REGION;</value>
    </envar>
    <envar>
      <name>NETWORK</name>
      <value>&NETWORK;</value>
    </envar>
  </task>
  <task name="runstats" cycledefs="daily" maxtries="2">
    <jobname>
      <cyclestr>runstats_@Y@m@d</cyclestr>
    </jobname>
    <dependency>
       <and>
         <taskdep task="get_synobs" state="succeeded"/>
         <taskdep task="qmd_to_ra" state="succeeded"/>
         <taskdep task="get_blend_qmd" state="succeeded"/>
       </and>
    </dependency>
    <command>
      <cyclestr>&HOMEDIR;/jobs/run_percentile.sh</cyclestr>
    </command>
    <join>
      <cyclestr>&PTMPROOT;/logs/percentile_&VER;_&VAR;_@Y@m@d.log</cyclestr>
    </join>
    <account>&ACT;</account>
    <nodesize>&NODESIZE;</nodesize>
    <queue>dev</queue>
    <nodes>1:ppn=1</nodes>
    <walltime>0:30:00</walltime>
    <memory>10G</memory>
    <envar>
      <name>RUNPDY</name>
      <value>&RUNDAY;</value>
    </envar>
    <envar>
      <name>VALPDY</name>
      <value>
        <cyclestr>@Y@m@d</cyclestr>
      </value>
    </envar>
    <envar>
      <name>VAR</name>
      <value>&VAR;</value>
    </envar>
    <envar>
      <name>VER</name>
      <value>&VER;</value>
    </envar>
    <envar>
      <name>PTMP</name>
      <value>&PTMPROOT;</value>
    </envar>
    <envar>
      <name>STMP</name>
      <value>&STMPROOT;</value>
    </envar> 
    <envar>
      <name>HOME</name>
      <value>&HOMEDIR;</value>
    </envar>
    <envar>
      <name>REGION</name>
      <value>&REGION;</value>
    </envar>
    <envar>
      <name>NETWORK</name>
      <value>&NETWORK;</value>
    </envar>
  </task>
</workflow>
